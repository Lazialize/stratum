# Product Steering

## Purpose

Stratumは、データベーススキーマをコードとして管理する**Infrastructure as Code (IaC)** CLIツールです。宣言的なYAMLファイルでスキーマを定義し、マイグレーションを自動生成・適用することで、複数環境にわたる安全で一貫性のあるスキーマ管理を実現します。

## Core Value Proposition

- **スキーマ定義の中央集権化**: YAMLファイルでスキーマをバージョン管理可能なコードとして記述
- **自動マイグレーション生成**: スキーマ変更から対応するSQL (up/down) を自動生成
- **安全性とトレーサビリティ**: チェックサム検証、適用履歴追跡、ロールバック機能
- **マルチデータベース対応**: PostgreSQL, MySQL, SQLiteをサポート

## Target Users

- **バックエンドエンジニア**: スキーマ変更をコードレビュー可能にしたい開発者
- **DevOps/SREチーム**: 複数環境でのスキーマ管理を自動化したい運用者
- **小規模プロジェクト**: SQLiteから始めてPostgreSQL/MySQLへスケールさせたいチーム

## Core Capabilities

### Schema-as-Code Workflow
1. **Define** - YAMLでテーブル、カラム、インデックス、制約を定義
2. **Validate** - 外部キー整合性、命名規則の検証
3. **Generate** - スキーマ差分からマイグレーションファイル生成
4. **Apply** - マイグレーション適用とデータベース更新
5. **Track** - 適用履歴の追跡とステータス確認
6. **Export** - 既存DBからスキーマコードへの逆方向変換

### Key Differentiators

- **方言抽象化**: 単一のYAML定義から各DB方言に適したSQLを生成
- **型の完全性**: 15種類のデータ型(INTEGER, DECIMAL, VARCHAR, DATE, UUID, JSONB等)を方言間でマッピング
- **宣言的アプローチ**: 現在の状態を定義すれば、差分は自動検出
- **検証ファースト**: 適用前にスキーマの整合性を検証

## Design Principles

1. **宣言性 (Declarative)**: 「どうやるか」ではなく「何であるべきか」を記述
2. **冪等性 (Idempotency)**: 同じスキーマ定義は常に同じ結果を生成
3. **バージョン管理親和性**: スキーマファイルとマイグレーションは全てテキストベース
4. **安全性優先**: dry-runモード、チェックサム検証、ロールバック機能
5. **データベース非依存**: 方言を抽象化し、移行コストを最小化

## Out of Scope

- データマイグレーション (ETL): スキーマ変更のみを対象、データの移行はサポート外
- クエリビルダー: ORMやクエリ生成機能は提供しない
- パフォーマンスチューニング: インデックス最適化の提案機能は現時点で対象外
- GUIインターフェース: CLIのみをサポート

## Success Metrics

- スキーマ変更のレビュー可能性 (GitでのPR/MR)
- マイグレーション失敗率の低減
- 複数環境間の一貫性保証
- 開発者のオンボーディング時間短縮
